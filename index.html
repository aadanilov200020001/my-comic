<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#111111">
  <meta name="color-scheme" content="dark">
  <title>Мой комикс</title>
  <style>
    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0;
      background: #111;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: sans-serif;
      color: #fff;
      overflow: hidden;
    }
    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100%;
      justify-content: center;
      width: 100%;
    }
    img {
      max-width: 95vw;
      max-height: 85vh;
      object-fit: contain;
      border-radius: 4px;
      transition: opacity 0.15s;
    }
    #info {
      margin-top: 10px;
      font-size: 14px;
      color: #aaa;
      text-align: center;
    }
    .nav-btn {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(74, 144, 226, 0.8);
      color: white;
      border: none;
      padding: 15px 20px;
      font-size: 24px;
      cursor: pointer;
      border-radius: 8px;
      z-index: 10;
      transition: background 0.2s;
    }
    .nav-btn:hover { background: rgba(74, 144, 226, 1); }
    .nav-btn:disabled { background: rgba(100, 100, 100, 0.5); cursor: not-allowed; }
    #prevBtn { left: 10px; }
    #nextBtn { right: 10px; }
    #loader {
      position: fixed;
      color: #888;
      font-size: 14px;
      bottom: 50px;
    }
    
    /* Кнопка полноэкранного режима */
    #fullscreenBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(74, 144, 226, 0.9);
      color: white;
      border: none;
      padding: 12px 16px;
      font-size: 20px;
      cursor: pointer;
      border-radius: 8px;
      z-index: 100;
      transition: background 0.2s;
    }
    #fullscreenBtn:hover { background: rgba(74, 144, 226, 1); }
    
    /* Скрываем кнопки на мобильных устройствах */
    @media (max-width: 768px) {
      .nav-btn {
        display: none;
      }
    }
    
    /* Полноэкранный режим */
    .fullscreen-mode #container {
      background: #000;
    }
    .fullscreen-mode img {
      max-width: 100vw;
      max-height: 100vh;
      border-radius: 0;
    }
    .fullscreen-mode #info,
    .fullscreen-mode #loader,
    .fullscreen-mode #fullscreenBtn {
      display: none !important;
    }
    .fullscreen-mode .nav-btn {
      display: none !important;
    }
    
    /* Подсказка для выхода из полноэкранного режима */
    #fullscreenHint {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 15px 25px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 1000;
      display: none;
      pointer-events: none;
      text-align: center;
    }
    .fullscreen-mode #fullscreenHint.show {
      display: block;
      animation: fadeOut 2s forwards;
      animation-delay: 1s;
    }
    @keyframes fadeOut {
      to { opacity: 0; }
    }
  </style>
</head>
<body>

<div id="container">
  <img id="page" alt="Страница комикса">
  <div id="info">Страница <span id="current">1</span> из <span id="total">208</span></div>
</div>
<div id="loader">Загрузка...</div>

<button id="prevBtn" class="nav-btn">←</button>
<button id="nextBtn" class="nav-btn">→</button>
<button id="fullscreenBtn" title="На весь экран">⛶</button>

<div id="fullscreenHint">Свайп вверх для выхода</div>

<script>
// === НАСТРОЙКИ ===
const TOTAL_PAGES = 208;
const FOLDER = "pages/";
const EXT = ".jpg";
// =================

let currentPage = 1;
let isFullscreen = false;
const img = document.getElementById("page");
const currentSpan = document.getElementById("current");
const totalSpan = document.getElementById("total");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const loader = document.getElementById("loader");
const fullscreenBtn = document.getElementById("fullscreenBtn");
const fullscreenHint = document.getElementById("fullscreenHint");
const container = document.getElementById("container");

totalSpan.textContent = TOTAL_PAGES;

function pageName(num) {
  return String(num);
}

function showPage() {
  loader.style.display = "block";
  img.style.opacity = "0.5";
  img.src = FOLDER + pageName(currentPage) + EXT;
  currentSpan.textContent = currentPage;
  
  prevBtn.disabled = (currentPage === 1);
  nextBtn.disabled = (currentPage === TOTAL_PAGES);
}

function nextPage() {
  if (currentPage < TOTAL_PAGES) {
    currentPage++;
    showPage();
  }
}

function prevPage() {
  if (currentPage > 1) {
    currentPage--;
    showPage();
  }
}

// Вход в полноэкранный режим
function enterFullscreen() {
  if (!isFullscreen) {
    isFullscreen = true;
    document.body.classList.add("fullscreen-mode");
    
    // Показываем подсказку
    fullscreenHint.classList.remove("show");
    void fullscreenHint.offsetWidth; // Триггер для перезапуска анимации
    fullscreenHint.classList.add("show");
    
    // Пробуем настоящий fullscreen API
    if (document.documentElement.requestFullscreen) {
      document.documentElement.requestFullscreen().catch(() => {});
    } else if (document.documentElement.webkitRequestFullscreen) {
      document.documentElement.webkitRequestFullscreen();
    }
  }
}

// Выход из полноэкранного режима
function exitFullscreen() {
  if (isFullscreen) {
    isFullscreen = false;
    document.body.classList.remove("fullscreen-mode");
    
    // Выход из настоящего fullscreen
    if (document.exitFullscreen) {
      document.exitFullscreen().catch(() => {});
    } else if (document.webkitExitFullscreen) {
      document.webkitExitFullscreen();
    }
  }
}

// Переключение полноэкранного режима
function toggleFullscreen() {
  if (isFullscreen) {
    exitFullscreen();
  } else {
    enterFullscreen();
  }
}

img.addEventListener("load", () => {
  loader.style.display = "none";
  img.style.opacity = "1";
  
  if (currentPage < TOTAL_PAGES) {
    const preload = new Image();
    preload.src = FOLDER + pageName(currentPage + 1) + EXT;
  }
});

// Клик по экрану
document.body.addEventListener("click", (e) => {
  if (e.target.classList.contains("nav-btn") || e.target.id === "fullscreenBtn") return;
  
  // В полноэкранном режиме клик ничего не делает
  if (isFullscreen) return;
  
  if (e.clientX > window.innerWidth / 2) {
    nextPage();
  } else {
    prevPage();
  }
});

// Кнопки навигации
prevBtn.addEventListener("click", prevPage);
nextBtn.addEventListener("click", nextPage);

// Кнопка полноэкранного режима
fullscreenBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  toggleFullscreen();
});

// Клавиатура
document.addEventListener("keydown", (e) => {
  if (e.key === "ArrowRight" || e.key === " " || e.key === "Enter") nextPage();
  if (e.key === "ArrowLeft") prevPage();
  if (e.key === "Escape" && isFullscreen) exitFullscreen();
  if (e.key === "f" || e.key === "F") toggleFullscreen();
});

// Свайпы
let touchStartX = 0;
let touchStartY = 0;

document.addEventListener("touchstart", (e) => {
  touchStartX = e.changedTouches[0].screenX;
  touchStartY = e.changedTouches[0].screenY;
}, {passive: true});

document.addEventListener("touchend", (e) => {
  const touchEndX = e.changedTouches[0].screenX;
  const touchEndY = e.changedTouches[0].screenY;
  
  const diffX = touchStartX - touchEndX;
  const diffY = touchStartY - touchEndY;
  
  // В полноэкранном режиме проверяем свайп вверх для выхода
  if (isFullscreen) {
    // Если свайп вверх больше 100px и он сильнее горизонтального
    if (diffY > 100 && Math.abs(diffY) > Math.abs(diffX)) {
      exitFullscreen();
      return;
    }
    // В полноэкранном режиме горизонтальные свайпы всё равно листают страницы
    if (diffX > 50 && Math.abs(diffX) > Math.abs(diffY)) {
      nextPage();
      return;
    }
    if (diffX < -50 && Math.abs(diffX) > Math.abs(diffY)) {
      prevPage();
      return;
    }
  } else {
    // Обычный режим — только горизонтальные свайпы
    if (diffX > 50) {
      nextPage();
    } else if (diffX < -50) {
      prevPage();
    }
  }
}, {passive: true});

// Отслеживание выхода из fullscreen (если пользователь нажал Escape)
document.addEventListener("fullscreenchange", () => {
  if (!document.fullscreenElement && isFullscreen) {
    exitFullscreen();
  }
});

showPage();
</script>

</body>
</html>